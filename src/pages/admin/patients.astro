---
import BaseLayout from "../../layouts/Base.astro";
import PatientManager from "../../components/admin/PatientManager.jsx";
---

<script is:inline>
  (function() {
    const sessionStr = localStorage.getItem("saluia.session");

    if (!sessionStr) {
      window.location.href = "/auth/login";
      return;
    }

    try {
      const session = JSON.parse(sessionStr);
      const role = session.user?.user_metadata?.role;

      if (role !== "admin") {
        window.location.href = "/";
      }

    } catch (e) {
      localStorage.removeItem("saluia.session");
      window.location.href = "/auth/login";
    }
  })();
</script>

<BaseLayout title="GestiÃ³n de Pacientes">
  <div class="container mx-auto p-6">
    <PatientManager client:only="react" />
  </div>
</BaseLayout>