---
import BaseLayout from "../../layouts/Base.astro";
import Card from "../../components/UI/Card.astro";
import InsuranceCompanyTable from "../../components/insurance_company/InsuranceCompanyTable.jsx";
---

<script is:inline>
  (function() {
    const sessionStr = localStorage.getItem("saluia.session");

    if (!sessionStr) {
      window.location.href = "/auth/login";
      return;
    }

    try {
      const session = JSON.parse(sessionStr);
      const role = session.user?.user_metadata?.role;

      if (role !== "admin") {
        window.location.href = "/";
      }

    } catch (e) {
      localStorage.removeItem("saluia.session");
      window.location.href = "/auth/login";
    }
  })();
</script>

<BaseLayout title="Aseguradoras â€” SaluIA">
  <Card>
    <div class="p-6 md:p-8 space-y-6">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Aseguradoras registradas</h2>

        <a
          href="/aseguradora/create"
          class="rounded-lg px-4 py-2 bg-health-accent text-white font-medium shadow-lg shadow-health-accent/10 hover:bg-health-accent-dark transition"
        >
          + Nueva Aseguradora
        </a>
      </div>

      <InsuranceCompanyTable client:load />
    </div>
  </Card>
</BaseLayout>
